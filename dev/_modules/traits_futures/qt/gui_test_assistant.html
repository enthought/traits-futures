<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>traits_futures.qt.gui_test_assistant &mdash; Traits Futures 0.3.0.dev0 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../../../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../../../_static/enthought.css" type="text/css" >
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" >
    <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" >
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3.0.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        LINK_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/js/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/js/wrap_on_dot.js"></script>
    <link rel="shortcut icon" href="../../../_static/img/favicon.ico">
    <link rel="index" title="Index" href="../../../genindex.html" >
    <link rel="search" title="Search" href="../../../search.html" >
    <link rel="top" title="Traits Futures 0.3.0.dev0 documentation" href="../../../index.html" >
    <link rel="up" title="Module code" href="../../index.html" > 
  </head>
  <body>
  <div class="container">
    <div class="header">
    </div>
  </div>

    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="../../../index.html">Traits Futures 0.3.0.dev0 documentation</a></li>
	
          <li class="active"><a href="../../index.html" accesskey="U">Module code</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../../../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="../../../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body" role="main">
            
  <h1>Source code for traits_futures.qt.gui_test_assistant</h1><div class="highlight"><pre>
<span></span><span class="c1"># (C) Copyright 2018-2021 Enthought, Inc., Austin, TX</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># This software is provided without warranty under the terms of the BSD</span>
<span class="c1"># license included in LICENSE.txt and may be redistributed only under</span>
<span class="c1"># the conditions described in the aforementioned license. The license</span>
<span class="c1"># is also available online at http://www.enthought.com/licenses/BSD.txt</span>
<span class="c1">#</span>
<span class="c1"># Thanks for using Enthought open source!</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Test support, providing the ability to run the event loop from tests.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pyface.qt.QtCore</span> <span class="kn">import</span> <span class="n">QTimer</span>
<span class="kn">from</span> <span class="nn">pyface.qt.QtGui</span> <span class="kn">import</span> <span class="n">QApplication</span>

<span class="c1">#: Default timeout, in seconds</span>
<span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mf">10.0</span>


<div class="viewcode-block" id="GuiTestAssistant"><a class="viewcode-back" href="../../../api/traits_futures.qt.gui_test_assistant.html#traits_futures.qt.gui_test_assistant.GuiTestAssistant">[docs]</a><span class="k">class</span> <span class="nc">GuiTestAssistant</span><span class="p">:</span>
<div class="viewcode-block" id="GuiTestAssistant.setUp"><a class="viewcode-back" href="../../../api/traits_futures.qt.gui_test_assistant.html#traits_futures.qt.gui_test_assistant.GuiTestAssistant.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qt_app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">qt_app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">qt_app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qt_app</span> <span class="o">=</span> <span class="n">qt_app</span></div>

<div class="viewcode-block" id="GuiTestAssistant.tearDown"><a class="viewcode-back" href="../../../api/traits_futures.qt.gui_test_assistant.html#traits_futures.qt.gui_test_assistant.GuiTestAssistant.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">qt_app</span></div>

<div class="viewcode-block" id="GuiTestAssistant.run_until"><a class="viewcode-back" href="../../../api/traits_futures.qt.gui_test_assistant.html#traits_futures.qt.gui_test_assistant.GuiTestAssistant.run_until">[docs]</a>    <span class="k">def</span> <span class="nf">run_until</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run event loop until the given condition holds true, or until timeout.</span>

<span class="sd">        The condition is re-evaluated, with the object as argument, every time</span>
<span class="sd">        the trait changes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object : traits.has_traits.HasTraits</span>
<span class="sd">            Object whose trait we monitor.</span>
<span class="sd">        trait : str</span>
<span class="sd">            Name of the trait to monitor for changes.</span>
<span class="sd">        condition : callable</span>
<span class="sd">            Single-argument callable, returning a boolean. This will be</span>
<span class="sd">            called with *object* as the only input.</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Number of seconds to allow before timing out with an exception.</span>
<span class="sd">            The (somewhat arbitrary) default is 10 seconds.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If timeout is reached, regardless of whether the condition is</span>
<span class="sd">            true or not at that point.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">qt_app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qt_app</span>

        <span class="n">timeout_in_ms</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">timeout_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">()</span>
        <span class="n">timeout_timer</span><span class="o">.</span><span class="n">setSingleShot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">timeout_timer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="n">timeout_in_ms</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">stop_on_timeout</span><span class="p">():</span>
            <span class="n">qt_app</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">stop_if_condition</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">condition</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                <span class="n">qt_app</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="nb">object</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="n">stop_if_condition</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># The condition may have become True before we</span>
            <span class="c1"># started listening to changes. So start with a check.</span>
            <span class="k">if</span> <span class="n">condition</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                <span class="n">timed_out</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timeout_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">stop_on_timeout</span><span class="p">)</span>
                <span class="n">timeout_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">timed_out</span> <span class="o">=</span> <span class="n">qt_app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">timeout_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                    <span class="n">timeout_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">stop_on_timeout</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="n">stop_if_condition</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timed_out</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;run_until timed out after </span><span class="si">{}</span><span class="s2"> seconds. &quot;</span>
                <span class="s2">&quot;At timeout, condition was </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">timeout</span><span class="p">,</span> <span class="n">condition</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/img/e-logo.png" alt="Logo">
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright (C) Copyright 2018-2021 Enthought, Inc., Austin, TX
All rights reserved.

This software is provided without warranty under the terms of the BSD
license included in LICENSE.txt and may be redistributed only under
the conditions described in the aforementioned license. The license
is also available online at http://www.enthought.com/licenses/BSD.txt

Thanks for using Enthought open source!

      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.5.3.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>